box: debian
build:
  steps:
    - arjen/hugo-build@1.10.1:
        version: "0.16"
        theme: aglaus
        flags: --buildDrafts=false

deploy:
  steps:
    - install-packages:
        packages: openssh-client
    - add-to-known_hosts:
        hostname: $SSH_HOST
    - mktemp:
        envvar: PRIVATEKEY_PATH
    - create-file:
        name: write key
        filename: $PRIVATEKEY_PATH
        content: $WEBSITE_PRIVATE
        overwrite: true
        hide-from-log: true
    - script:
        name: transfer application
        code: |
          scp -r -P $SSH_PORT -i $PRIVATEKEY_PATH -o StrictHostKeyChecking=no -o UserKnownHostsFile=no public/* $SSH_USER@$SSH_HOST:$OUTPUT_DIR
          ls -lah
