box: debian
build:
  steps:
    - arjen/hugo-build@1.10.1:
        version: "0.16"
        theme: aglaus
        flags: --buildDrafts=true

deploy:
  steps:
    - install-packages:
        packages: openssh-client
    - add-to-known_hosts:
        hostname: $SSH_HOST
    - mktemp:
        envvar: PRIVATEKEY_PATH
    - create-file:
        name: write key
        filename: $PRIVATEKEY_PATH
        content: $WEBSITE_PRIVATE
        overwrite: true
        hide-from-log: true
    - script:
        name: stop application
        code: ssh -i $PRIVATEKEY_PATH  -l $SSH_USER -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $SSH_HOST -p $SSH_PORT ls $OUTPUT_DIR -la
    - script:
        name: transfer application
        code: |
          pwd
          ls -la
          scp -r -P $SSH_PORT -i $PRIVATEKEY_PATH -o UserKnownHostsFile=no public/* $SSH_USER@$SSH_HOST:$OUTPUT_DIR
